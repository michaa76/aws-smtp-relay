language: java
services:
  - docker
script:
  - mvn package
  - docker run -v `pwd`/target:/smtp oracle/graalvm-ce bash -c "cd /smtp && gu install native-image && native-image -jar /smtp/*-with-dependencies.jar --no-fallback --static aws-smtp-relay"
  - mvn package -P debian
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: 6ac634e0f364ea9d6708044fe616116c48d4ddf7
  file_glob: true
  file:
    - target/aws-smtp-relay
    - target/aws-smtp-relay*.jar
    - target/aws-smtp-relay_*.deb
  on:
    repo: michaa76/aws-smtp-relay
    tags: true
